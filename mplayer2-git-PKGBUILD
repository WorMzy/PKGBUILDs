# Maintainer:  Matt Monaco <net 0x01b dgbaley27>
# Contributor: Matej Lach <matej.lach@gmail.com>
# Contributor: cantabile <cantabile dot desu at gmail dot com>
# Contributor: extcake < extcake@gmail.com >

_gitroot="git://git.mplayer2.org/mplayer2-build.git"

pkgname=mplayer2-git
_gitname="mplayer2"
pkgver=20130412
pkgrel=1
pkgdesc="An advanced general-purpose video player."
url="http://www.mplayer2.org"
license=(GPL3)
arch=('x86_64' 'i686')
install="$pkgname.install"
source=("git://git.mplayer2.org/mplayer2.git"
        "$pkgname.install")
sha256sums=('SKIP'
            'b32b52959e65de2482beece9790b9d6cc4ead9cbcb975391e37b58b1ef4f5abf')
sha256sums=('SKIP'
            '7394ba944d1b98a4407b4aa84a9dd057db7db9624648df0dac9e4f6289d8d7f1')
backup=("etc/mplayer/codecs.conf"
        "etc/mplayer/input.conf")
depends=("libdvdread" "libdvdnav" "libass" "ffmpeg" "libgl" "libxv" "fribidi" "libvdpau" "libpulse" "xvidcore" "libxss" "sdl"
         "freetype2" "fontconfig" "desktop-file-utils")
# The dependencies here are *required* to build by the default options. fribidi
# is needed for libass. freetype2 and fontconfig are needed for mplayer itself
# (yes, ./configure --help says they are autodetected, but it lies, they need to
# be explicitly disabled)
makedepends=("git" "yasm" "python" "python-docutils")
conflicts=("mplayer" "mplayer2")
provides=("mplayer" "mplayer2")
options=("!emptydirs")

pkgver() {
  cd "$_gitname"
  git describe | sed 's:-:.:g'
}

build() {
	cd "$_gitname"

  ./configure --prefix=/usr --confdir=/etc/mplayer
	make
}

package() {
	cd "$_gitname"
	make DESTDIR="$pkgdir" install

	install -m644 etc/{codecs,input,example}.conf "$pkgdir/etc/mplayer"
	
	install -dm755 "$pkgdir/usr/share/mplayer"
	install -dm755 "$pkgdir/usr/share/fonts/OSD"
	
	ln -s "$srcdir/fonts/TTF/DejaVuSans.ttf" "$pkgdir/usr/share/mplayer/subfont.ttf"
	
	sed -i 's/gmplayer/mplayer/g' "etc/mplayer.desktop"
	install -Dm644 "etc/mplayer.desktop" "$pkgdir/usr/share/applications/mplayer.desktop"

	install -Dm644 "etc/mplayer.xpm" "$pkgdir/usr/share/pixmaps/mplayer.xpm"

	install -Dm644 "sub/osd_font.otf" "$pkgdir/usr/share/fonts/OSD/osd_font.otf"
}
